@model LawyersSyndicatePortal.Models.ExamAttendee

@{
    ViewBag.Title = "Create";
}

@section Styles {
    <!-- إضافة رابط ملف الستايل الجديد -->
    <link rel="stylesheet" href="~/Content/Examstylenew.css" />
    <!-- إضافة ملفات jQuery UI للبحث التلقائي (Autocomplete) -->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
}

<h2>إضافة ملتحق جديد</h2>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h4>معلومات الملتحق</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(model => model.ExamId)

        <div class="form-group">
            @Html.LabelFor(model => model.LawyerIdNumber, "رقم الهوية أو اسم المحامي", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <!-- تم تعديل الحقل ليتم استخدامه للبحث التلقائي -->
                @Html.EditorFor(model => model.LawyerIdNumber, new { htmlAttributes = new { @class = "form-control", id = "lawyerSearchInput" } })
                @Html.ValidationMessageFor(model => model.LawyerIdNumber, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.MobileNumber, "رقم الجوال", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.MobileNumber, new { htmlAttributes = new { @class = "form-control", id = "mobileNumberInput" } })
                @Html.ValidationMessageFor(model => model.MobileNumber, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <div class="checkbox">
                    @Html.EditorFor(model => model.CanAttend)
                    @Html.LabelFor(model => model.CanAttend, "هل يحق له الالتحاق؟")
                </div>
            </div>
        </div>

        <!-- تم إضافة حقل الاختيار هذا للخاصية الجديدة -->
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <div class="checkbox">
                    @Html.EditorFor(model => model.IsExamVisible)
                    @Html.LabelFor(model => model.IsExamVisible, "هل الاختبار مرئي له؟")
                </div>
            </div>
        </div>
        <!-- نهاية الحقل الجديد -->

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <!-- تم تغيير الزر ليستخدم تنسيق btn-primary -->
                <input type="submit" value="إنشاء" class="btn btn-primary" />
            </div>
        </div>
    </div>
}

<div class="mt-3">
    <!-- تم تعديل هذا الجزء ليظهر الرابط كزر ملون -->
    @Html.ActionLink("العودة إلى القائمة", "Index", new { examId = (Model != null) ? Model.ExamId : ViewBag.ExamId }, new { @class = "btn btn-secondary" })
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <!-- إضافة مكتبة jQuery و jQuery UI -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            // تهيئة البحث التلقائي على حقل رقم الهوية
            $("#lawyerSearchInput").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '@Url.Action("SearchLawyers", "ExamAttendees")',
                        dataType: "json",
                        data: {
                            query: request.term
                        },
                        success: function (data) {
                            response($.map(data, function (item) {
                                return {
                                    label: item.name + " (" + item.idNumber + ")",
                                    value: item.idNumber, // القيمة التي ستظهر في الحقل
                                    idNumber: item.idNumber,
                                    mobileNumber: item.mobileNumber
                                };
                            }));
                        }
                    });
                },
                minLength: 2, // يبدأ البحث بعد كتابة حرفين
                select: function (event, ui) {
                    // عند اختيار عنصر من القائمة، قم بتعبئة رقم الهوية ورقم الجوال
                    $("#lawyerSearchInput").val(ui.item.idNumber);
                    $("#mobileNumberInput").val(ui.item.mobileNumber);
                    return false; // منع تعبئة الحقل تلقائياً بالقيمة
                }
            });
        });
    </script>
}
