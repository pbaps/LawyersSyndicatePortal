@model IEnumerable<LawyersSyndicatePortal.Models.ExamAttendee>

@{
    ViewBag.Title = "Exam Attendees";
    var exam = ViewBag.Exam as LawyersSyndicatePortal.Models.Exam;
}

@section Styles {
    <!-- إضافة رابط ملف الستايل الجديد في قسم الستايلات -->
    <link href="@Url.Content("~/Content/Examstylenew.css")" rel="stylesheet" type="text/css" />
}

<h2>الملتحقون بالامتحان: @exam.Title</h2>

<p class="d-flex gap-2">
    <!-- تعديل الروابط لتظهر كأزرار ملونة -->
    @Html.ActionLink("إضافة ملتحق جديد", "Create", new { examId = exam.Id }, new { @class = "btn btn-primary" })
    @Html.ActionLink("تصدير البيانات", "Export", new { examId = exam.Id }, new { @class = "btn btn-success" })
    <a href="@Url.Action("DownloadImportTemplate", new { examId = exam.Id })" class="btn btn-secondary">
        تحميل نموذج CSV
    </a>
    <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#importModal">
        استيراد من ملف CSV
    </button>
</p>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">
        @TempData["SuccessMessage"]
    </div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">
        @TempData["ErrorMessage"]
    </div>
}

<table class="table">
    <tr>
        <th>
          رقم الهوية
        </th>
        <th>
            الاسم الكامل
        </th>
        <th>
            رقم الجوال
        </th>
        <th>
            هل يحق له الالتحاق؟
        </th>
        <th>
            هل الاختبار مرئي له؟
        </th>
        <th>
            هل أكمل الاختبار؟
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.LawyerIdNumber)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Lawyer.FullName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.MobileNumber)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.CanAttend)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.IsExamVisible)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.IsCompleted)
            </td>
            <td>
                @Html.ActionLink("تعديل", "Edit", new { id = item.Id }, new { @class = "btn btn-warning btn-sm me-2" })
                @Html.ActionLink("تفاصيل", "Details", new { id = item.Id }, new { @class = "btn btn-info btn-sm me-2" })
                @Html.ActionLink("حذف", "Delete", new { id = item.Id }, new { @class = "btn btn-danger btn-sm" })
            </td>
        </tr>
    }
</table>
<div class="mt-3">
    <!-- الرابط الجديد للعودة إلى صفحة الاختبار -->
    @Html.ActionLink("العودة إلى الاختبار", "Index", "Exams", new { area = "" }, new { @class = "btn btn-secondary" })
</div>

<!-- Modal for import -->
<div class="modal fade" id="importModal" tabindex="-1" role="dialog" aria-labelledby="importModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="importModalLabel">استيراد بيانات</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            @using (Html.BeginForm("Import", "ExamAttendees", FormMethod.Post, new { enctype = "multipart/form-data" }))
            {
                @Html.AntiForgeryToken()
                <div class="modal-body">
                    <p>الرجاء اختيار ملف CSV لاستيراد بيانات الملتحقين.</p>
                    <input type="hidden" name="examId" value="@exam.Id" />
                    <input type="file" name="file" accept=".csv" required />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="submit" class="btn btn-primary">استيراد</button>
                </div>
            }
        </div>
    </div>
</div>
