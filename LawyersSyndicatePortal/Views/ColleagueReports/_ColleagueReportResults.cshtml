 
@model LawyersSyndicatePortal.ViewModels.ColleagueReportResultViewModel
@using System.Linq
@using System.Reflection
@using LawyersSyndicatePortal.ViewModels

@*
    هذا هو الجزء (Partial View) المسؤول عن عرض نتائج التقرير في جدول.
    يتم تحديثه بشكل ديناميكي عبر AJAX.
*@

@* حاوية عرض عدد النتائج *@
@* Note: This part is now handled in the parent view directly to ensure it appears on the initial page load *@

@if (Model.SearchResultsCount > 0)
{
    <div class="badge bg-success text-white fs-6 py-2 px-3 rounded-pill shadow-sm mb-1" dir="rtl">
        <i class="fas fa-database me-2"></i> تم العثور على <strong>@Model.SearchResultsCount</strong> سجل مطابق لنتائج البحث.
    </div>

}

@if (Model != null && Model.Reports != null && Model.Reports.Any())
{
    @*
        الفـرز الأبجدي حسب اسم الزميل.
    *@
    <div class="table-responsive">
        <div class="report-table mt-4">
            <table class="table table-striped table-bordered table-responsive-md text-right" dir="rtl">
                <thead>
                    <tr>
                        @foreach (var column in Model.SelectedColumns)
                        {
                            <th>@column.DisplayName</th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @foreach (var reportItem in Model.Reports.OrderBy(r => r.ColleagueFullName))
                    {
                        <tr>
                            @foreach (var column in Model.SelectedColumns)
                            {
                                <td>
                                    @{
                                        // استخدم Reflection للحصول على قيمة الخاصية من الـ ReportItem
                                        var prop = typeof(ColleagueReportResultItem).GetProperty(column.ColumnName);
                                        if (prop != null)
                                        {
                                            object value = prop.GetValue(reportItem, null);
                                            if (value != null)
                                            {
                                                // تنسيق التاريخ إذا كانت القيمة من نوع DateTime
                                                if (value is DateTime dateTimeValue)
                                                {
                                                    @(dateTimeValue.ToShortDateString())
                                                }
                                                else
                                                {
                                                    @value.ToString()
                                                }
                                            }
                                            else
                                            {
                                                @:غير متوفر
                                            }
                                        }
                                        else
                                        {
                                            @:غير متوفر
                                        }
                                    }
                                </td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}
else
{
    <div class="alert alert-info text-center mt-5" role="alert">
        <i class="fas fa-info-circle ml-2"></i> لا توجد نتائج مطابقة لمعايير البحث المحددة.
    </div>
}
