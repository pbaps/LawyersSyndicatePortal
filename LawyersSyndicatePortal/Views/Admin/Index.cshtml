@* المسار: LawyersSyndicatePortal\Views\Admin\Index.cshtml --}}*@
@model LawyersSyndicatePortal.ViewModels.NewLawyerReportViewModel
@using System.Web.Mvc.Html
@using System.Globalization
@using LawyersSyndicatePortal.Models
@using System.Linq
@using System.Collections.Generic

@{
    ViewBag.Title = "لوحة تحكم المسؤول";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";

    var dbContext = new ApplicationDbContext();
    int totalLawyersCount = dbContext.Lawyers.Count();
    var professionalStatuses = new List<string> { "مزاول", "غير مزاول", "متدرب", "موقوف", "مشطوب", "متقاعد", "متوفي" };
    var statusCounts = new Dictionary<string, int>();
    var statusIcons = new Dictionary<string, string>
{
        { "مزاول", "fas fa-briefcase text-success" },
        { "غير مزاول", "fas fa-user-slash text-warning" },
        { "متدرب", "fas fa-user-graduate text-info" },
        { "موقوف", "fas fa-hand-paper text-danger" },
        { "مشطوب", "fas fa-user-times text-secondary" },
        { "متقاعد", "fas fa-door-closed text-primary" },
        { "متوفي", "fas fa-cross text-dark" }
    };
    foreach (var status in professionalStatuses)
    {
        statusCounts[status] = dbContext.Lawyers.Count(l => l.ProfessionalStatus == status);
    }
    dbContext.Dispose();
}

<style>
    body {
        background-color: #f4f7f9;
    }

    .dashboard-card {
        background: #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        padding: 24px;
        margin-bottom: 24px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: flex;
        flex-direction: column;
        border: 1px solid #e9ecef;
    }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
        }

    .card-header-icon {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 8px;
        font-size: 1.8em;
    }

    .main-stats-card {
        background-color: #e3f2fd;
        border: 1px solid #bbdefb;
        color: #007bff;
        text-align: center;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

        .main-stats-card h6 {
            font-size: 1em;
            margin-bottom: 8px;
            color: #495057;
        }

        .main-stats-card .count {
            font-size: 2.8em;
            font-weight: 800;
            color: #0d47a1;
        }

    .action-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .action-list-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #f0f0f0;
    }

        .action-list-item:last-child {
            border-bottom: none;
        }

        .action-list-item .label-text {
            display: flex;
            align-items: center;
            font-size: 0.95em;
            color: #495057;
        }

            .action-list-item .label-text i {
                margin-left: 10px;
            }

    .audit-log-entry {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 10px;
        border-left: 4px solid #007bff;
    }

    .audit-action-line {
        display: block;
        font-weight: 500;
        color: #333;
    }

    .audit-details-line {
        font-size: 0.85em;
        color: #6c757d;
        display: block;
        margin-top: 4px;
    }
</style>

<div class="jumbotron text-center" dir="rtl" style="background-color: #e9ecef; padding: 2.5rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
    <h4 class="display-6" style="color: #2c3e50; font-weight: bold;">مرحباً بك في لوحة تحكم المسؤول 👋</h4>
    <p class="lead text-muted">نظرة عامة سريعة على أهم الإحصائيات والأدوات الإدارية.</p>
    <hr class="my-4">
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show text-right" dir="rtl" role="alert">
        @Html.Raw(TempData["SuccessMessage"])
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show text-right" dir="rtl" role="alert">
        @Html.Raw(TempData["ErrorMessage"])
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}

<div class="container-fluid text-right" dir="rtl">
    <div class="row">
        <div class="col-lg-6 col-md-12">
            <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="m-0 font-weight-bold">إحصائيات المحامين</h5>
                    <i class="fas fa-balance-scale card-header-icon text-secondary"></i>
                </div>
                <div class="main-stats-card">
                    <h6>إجمالي عدد المحامين المسجلين</h6>
                    <span class="count">@totalLawyersCount</span>
                </div>
                <div class="row no-gutters mb-4">
                    @foreach (var status in professionalStatuses)
                    {
                        <div class="col-6 p-2">
                            <div class="d-flex align-items-center justify-content-between p-2 rounded" style="background-color:#f8f9fa;">
                                <span class="label-text">
                                    <i class="@(statusIcons[status])"></i>
                                    @status
                                </span>
                                <span class="font-weight-bold text-dark">@statusCounts[status]</span>
                            </div>
                        </div>
                    }
                </div>
                @Html.ActionLink("عرض تقارير المحامين", "Index", "SpecializedReports", null, new { @class = "btn btn-info btn-block mt-auto" })
            </div>

            <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="m-0 font-weight-bold">إدارة المحامين والمستخدمين</h5>
                    <i class="fas fa-users-cog card-header-icon text-primary"></i>
                </div>
                <ul class="action-list">
                    <li class="action-list-item">
                        <span class="label-text"><i class="fas fa-user-plus text-success"></i> إضافة محامي جديد</span>
                        @Html.ActionLink("إضافة", "Create", "Lawyers", null, new { @class = "btn btn-sm btn-success" })
                    </li>
                    <li class="action-list-item">
                        <span class="label-text"><i class="fas fa-search text-primary"></i> عرض وتعديل المحامين</span>
                        @Html.ActionLink("عرض", "Index", "Lawyers", null, new { @class = "btn btn-sm btn-primary" })
                    </li>
                    <li class="action-list-item">
                        <span class="label-text"><i class="fas fa-user-plus text-success"></i> إضافة مستخدم جديد</span>
                        @Html.ActionLink("إضافة", "Create", "Users", null, new { @class = "btn btn-sm btn-success" })
                    </li>
                    <li class="action-list-item">
                        <span class="label-text"><i class="fas fa-search text-primary"></i> عرض وتعديل المستخدمين</span>
                        @Html.ActionLink("عرض", "Index", "Users", null, new { @class = "btn btn-sm btn-primary" })
                    </li>
                </ul>
            </div>
        </div>

        <div class="col-lg-6 col-md-12">
            <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="m-0 font-weight-bold">إدارة الاتصالات والرسائل</h5>
                    <i class="fas fa-envelope-open-text card-header-icon text-info"></i>
                </div>
                <ul class="action-list">
                    <li class="action-list-item">
                        <span class="label-text"><i class="fas fa-paper-plane text-success"></i> إرسال رسالة خاصة</span>
                        @Html.ActionLink("إرسال", "Compose", "Messages", null, new { @class = "btn btn-sm btn-success" })
                    </li>
                    <li class="action-list-item">
                        <span class="label-text"><i class="fas fa-broadcast-tower text-danger"></i> إرسال تعميم إداري</span>
                        @Html.ActionLink("إرسال", "ComposeBroadcast", "Messages", null, new { @class = "btn btn-sm btn-danger" })
                    </li>
                    <li class="action-list-item">
                        <span class="label-text"><i class="fas fa-inbox text-primary"></i> صندوق وارد الإدارة</span>
                        @Html.ActionLink("عرض", "AdminInbox", "Messages", null, new { @class = "btn btn-sm btn-primary" })
                    </li>
                    <li class="action-list-item">
                        <span class="label-text"><i class="fas fa-envelope text-info"></i> رسائل الاتصال الواردة</span>
                        @Html.ActionLink("عرض", "AdminContactMessages", "Messages", null, new { @class = "btn btn-sm btn-info" })
                    </li>
                    <li class="action-list-item">
                        <span class="label-text"><i class="fas fa-bullhorn text-warning"></i> التعميمات والإعلانات</span>
                        @Html.ActionLink("عرض", "AdminBroadcasts", "Messages", null, new { @class = "btn btn-sm btn-warning" })
                    </li>
                </ul>
            </div>

            <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="m-0 font-weight-bold">التقارير والاستعلامات</h5>
                    <i class="fas fa-chart-line card-header-icon text-info"></i>
                </div>
                <ul class="action-list mb-4">
                    <li class="action-list-item">
                        <span class="label-text"><i class="fas fa-file-alt text-success"></i> مركز التقارير والاستعلامات</span>
                        @Html.ActionLink("عرض", "ReportsAndQueries", "Admin", null, new { @class = "btn btn-sm btn-success" })
                    </li>
                </ul>
            </div>

            <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="m-0 font-weight-bold">صفحة الاختبارات</h5>
                    <i class="fas fa-flask card-header-icon text-secondary"></i>
                </div>
                <ul class="action-list">
                    <li class="action-list-item">
                        <span class="label-text"><i class="fas fa-tasks text-info"></i> إدارة الاختبارات</span>
                        @Html.ActionLink("إدارة", "Index", "Exams", null, new { @class = "btn btn-sm btn-info" })
                    </li>
                    <li class="action-list-item">
                        <span class="label-text"><i class="fas fa-poll-h text-success"></i> نتائج الاختبارات</span>
                        @Html.ActionLink("نتائج", "Index", "AdminResult", null, new { @class = "btn btn-sm btn-success" })
                    </li>
                </ul>
            </div>

            <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="m-0 font-weight-bold">آخر الإجراءات الإدارية</h5>
                    <i class="fas fa-history card-header-icon text-warning"></i>
                </div>
                <ul class="list-unstyled">
                    @if (Model.LatestAuditLogs != null && Model.LatestAuditLogs.Any())
                    {
                        foreach (var log in Model.LatestAuditLogs.Take(2))
                        {
                            <li class="audit-log-entry">
                                <span class="audit-action-line">
                                    <i class="fas fa-info-circle text-primary ml-2"></i> @log.AdminName قام بـ @log.Action على جدول @log.TableName.
                                </span>
                                <span class="audit-details-line">@log.Details</span>
                                <small class="text-muted mr-3 d-block mt-2">@log.Timestamp.ToString("yyyy-MM-dd HH:mm")</small>
                            </li>
                        }
                    }
                    else
                    {
                        <li><i class="fas fa-exclamation-circle text-warning ml-2"></i> لا توجد تحديثات حالياً.</li>
                    }
                </ul>
                @Html.ActionLink("عرض جميع الإجراءات", "Index", "AuditLogs", null, new { @class = "btn btn-secondary mt-3 btn-block" })
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        $(document).ready(function () {
            window.setTimeout(function () {
                $(".alert").fadeTo(500, 0).slideUp(500, function () {
                    $(this).remove();
                });
            }, 5000);
        });
    </script>
}