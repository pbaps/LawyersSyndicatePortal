@model LawyersSyndicatePortal.Models.ManageLoginsViewModel
@using Microsoft.Owin.Security
@{
    ViewBag.Title = "إدارة تسجيلات الدخول الخارجية الخاصة بك";
}

<style>
    body {
        background-color: #E8F0F7; /* تطبيق خلفية الصفحة من ملف التخطيط */
        font-family: 'Cairo', sans-serif; /* تطبيق خط Cairo من ملف التخطيط */
    }

    .container {
        padding-top: 50px;
        padding-bottom: 50px;
    }

    .card {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        padding: 30px;
    }

    h2, h4 {
        color: #343a40;
        text-align: right; /* محاذاة لليمين للنصوص العربية */
    }

    hr {
        border-top: 1px solid #dee2e6;
        margin-bottom: 30px;
    }

    .btn {
        border-radius: 5px; /* حواف مستديرة للأزرار */
    }

    .text-success {
        color: #28a745 !important; /* لون أخضر للرسائل الناجحة */
    }

    .alert {
        text-align: right; /* محاذاة لليمين للتنبيهات */
    }

        /* تحسين زر الإغلاق في التنبيهات لـ Bootstrap 5 */
        .alert .btn-close {
            padding: 0.5rem 0.5rem;
            margin: -0.375rem -0.375rem -0.375rem auto;
        }

    .table th, .table td {
        text-align: right; /* محاذاة لليمين لرؤوس وخلايا الجدول */
        vertical-align: middle;
    }

    .table thead th {
        background-color: #f8f9fa;
        font-weight: bold;
    }
</style>

<div class="container py-5" dir="rtl">
    <div class="card">
        <h2 class="mb-4">@ViewBag.Title</h2>

        @* رسالة الحالة (نجاح/خطأ) *@
        @if (!string.IsNullOrEmpty(ViewBag.StatusMessage))
        {
            <div class="alert @(ViewBag.StatusMessage.Contains("Error") ? "alert-danger" : "alert-success") alert-dismissible fade show text-right" role="alert">
                @ViewBag.StatusMessage
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }

        @{
            var loginProviders = Context.GetOwinContext().Authentication.GetExternalAuthenticationTypes();
            if (loginProviders.Count() == 0)
            {
                <div class="alert alert-info text-right" role="alert">
                    <p>
                        لا توجد خدمات مصادقة خارجية مهيأة. راجع <a href="https://go.microsoft.com/fwlink/?LinkId=313242" target="_blank">هذا المقال</a>
                        للحصول على تفاصيل حول إعداد تطبيق ASP.NET هذا لدعم تسجيل الدخول عبر الخدمات الخارجية.
                    </p>
                </div>
            }
            else
            {
                if (Model.CurrentLogins.Count > 0)
                {
                    <h4 class="mb-3">تسجيلات الدخول المسجلة</h4>
                    <div class="table-responsive mb-4">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>مزود تسجيل الدخول</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var account in Model.CurrentLogins)
                                {
                                    <tr>
                                        <td>@account.LoginProvider</td>
                                        <td>
                                            @if (ViewBag.ShowRemoveButton)
                                            {
                                                using (Html.BeginForm("RemoveLogin", "Manage", FormMethod.Post, new { @class = "d-inline-block" }))
                                                {
                                                    @Html.AntiForgeryToken()
                                                    @Html.Hidden("loginProvider", account.LoginProvider)
                                                    @Html.Hidden("providerKey", account.ProviderKey)
                                                    <button type="submit" class="btn btn-danger btn-sm" title="إزالة تسجيل الدخول @account.LoginProvider من حسابك">إزالة</button>
                                                }
                                            }
                                            else
                                            {
                                                @: &nbsp;
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                if (Model.OtherLogins.Count > 0)
                {
                    <h4 class="mb-3">إضافة تسجيل دخول آخر</h4>
                    using (Html.BeginForm("LinkLogin", "Manage", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
                    {
                        @Html.AntiForgeryToken()
                        <div id="socialLoginList" class="d-flex flex-wrap gap-2">
                            @foreach (AuthenticationDescription p in Model.OtherLogins)
                            {
                                <button type="submit" class="btn btn-outline-primary" id="@p.AuthenticationType" name="provider" value="@p.AuthenticationType" title="تسجيل الدخول باستخدام حساب @p.Caption">@p.AuthenticationType</button>
                            }
                        </div>
                    }
                }
            }
        }
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
